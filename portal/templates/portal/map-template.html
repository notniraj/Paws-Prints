{% load static %}
<!-- map-template.html -->
<div id="map"></div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
<script>
    $(document).ready(function() {
        // Leaflet initialization code
        var map = L.map('map').setView([27.71, 85.322], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Initialize a global variable to store the marker
        var marker = L.marker([27.71, 85.322]).addTo(map);

        // Add event listener to capture marker movement
        marker.on('dragend', function (event) {
            var markerLocation = marker.getLatLng();
            // Send markerLocation to Django view via AJAX
            // Example AJAX call
            $.ajax({
                type: "POST",
                url: "/update-location/",
                data: {
                    'latitude': markerLocation.lat,
                    'longitude': markerLocation.lng,
                    // Additional data if needed
                },
                success: function (data) {
                    // Handle success response
                },
                error: function (xhr, errmsg, err) {
                    // Handle error response
                }
            });
        });
    });
    
</script>
